dist: trusty

language:
    - php

branches:
  only:
    - codeception
php:
     - 5.6.4
#    - 7.1

addons:
  browserstack:
    username: rtcamp3
    access_key:
     #secure: VFBgrctr5uDgE4PIea7QoXJDdQqq5TjPhvEcEBBcymbsP7cYUniD8K/0At+hArw5fqKajNlPZZjbxEhBRVv4hXNin++S6qwLeHCQMyHWQTt5vOULL16R2GsO30QUkFT/Egw2rh9v6qBei7Ol2mwz7i+XzZQE8cSDa/TJl7wMVwU=

     secure: FrhViixkGs/TN2sH5EPMiwHfcLtmGZxpx460eyoyb23SpN8VvhbWWfJCU6PNFpysHyWJvn6wfP602Rp8qReeLiYs3G3SX2548dMKXwxkaw0wp738mUN/pmI70yKO0j18xuPDyMH1twS7kReR4tnNlkJ9LM1ccIYCQyMGyGhIVgtDl13f2l3Njbz9FgtzfRtllMZyWXluNLlnVBqBgfvOhJvVwP6X7sAXPZmJqGYCgKsPbDLFI2VMrHnkucHak13g2BALPEhmECiP7FG5VZWIb67jHFt1b/3y80ZdneH6jgIVij5ERPorofXUICYGHonxawE2h5MylVCoAMqC4Gnbm6v+ZWEkdkIKKqShjrD0Ay8mICGRv9t6UId/UymA7P7JKER3n/+oUPYdGB0zr6eFsOVke1NrDiYiFoNCz8gkybz0dflC7j+KguubLXTILGcLNsiqiBSAMp9vmLzggBqt/h2ftwkxUuY5o5/GY51sKQj2yvJdVBuFLYfFsLCgB4gqnAy6y5U575sVZ2pvM4DCSI8DgRmIPWSQl79lFC9uGcy7F+rmiPcD0f7WGZdIf1nPGcIdaliaWjkvpN1kTqlKZK0SoR+kebtg47FwUJY/LOQKVCNNdkSZmyhhiNgs3/ABwsgIZ9VuIxlPpnf90/K4w61vMSN+2/V4zqPVYEbSzTU=


before_install:
- rm -rf ~/.gnupg

cache:
  paths:
  - vendor/

before_script:
- export PLUGIN_DIR=$(pwd)
- sudo rm -rf /etc/mysql/
- sudo apt-get -qq purge mysql* graphviz* && sudo apt-get -qq autoremove
- sudo bash -c 'echo -e "[user]\n\tname = abc\n\temail = root@localhost.com" > /home/travis/.gitconfig'
- wget -qO ee rt.cx/ee && sudo bash ee
- sudo apt-get update
- sudo tail /var/log/ee/ee.log
- sudo ee site create automation.rtmedia.me --wp --user=ADMINUSER --email=bhargav.bhandari@rtcamp.com --pass=ADMINPASS
- sudo sed -i '/^127.0.0.1/ s/$/ automation.rtmedia.me/' /etc/hosts
- sudo chmod 777 -R /var/www
- cd /var/www/automation.rtmedia.me/htdocs/wp-content/plugins/ && mkdir rtMedia
- cd $PLUGIN_DIR
- cp -Rf * /var/www/automation.rtmedia.me/htdocs/wp-content/plugins/rtMedia/
- cd /var/www/automation.rtmedia.me/htdocs/
- wp --allow-root plugin install https://downloads.wordpress.org/plugin/buddypress.2.8.2.zip
- wp plugin activate --all
- cd /var/www/automation.rtmedia.me/htdocs/wp-content/themes/
- wp theme activate twentysixteen
#- wp theme activate twentyseventeen
- cd $PLUGIN_DIR
- cd tests/codeception/tests/_data
- git clone --depth=1 https://github.com/rtCamp/rtmedia-test-data.git test-data
- cd /tmp
- wget http://www.browserstack.com/browserstack-local/BrowserStackLocal-linux-x64.zip
- unzip BrowserStackLocal-linux-x64.zip
- nohup ./BrowserStackLocal --key $BROWSERSTACK_ACCESS_KEY &
- cd $PLUGIN_DIR/tests/codeception/
- composer update
- export PATH="$PATH:/home/travis/build/BhargavBhandari90/rtMedia/tests/codeception/vendor/bin"

script:
- wpcept run acceptance --steps
